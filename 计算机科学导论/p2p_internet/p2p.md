# P2P简介

- peer-to-peer
- P2P是一种网络技术，可以在不同的计算机之间共享各种计算资源，如CPU、网络宽带和存储。
- P2P是当今用户在线共享文件（如音乐、图像和其它数字媒体）的一种非常常用的方法。
  1. Bittorrent和Gnutella是流行的文件共享p2p应用程序的列子。以及比特币和以太坊等区块链网络。
  2. 它们不依赖中央服务器或中介来连接多个客户端。
  3. 最重要的是，它们利用用户的计算机作为客户端和服务器，从而将计算从中央服务器上卸载下来。
- 传统的分布式系统使用Client-Server范式来部署
- P2P是另一种分布式系统
  1. 在P2P，一组节点（或对等点，Peer）彼此直接交互以共同提供公共服务，而无需中央协调器或管理员
  2. P2P系统中的每个节点（或Peer）都可以充当客户端（从其它节点请求信息）和服务器（存储/检索数据并响应客户端请求执行必要的计算）。
  3. P2P网络中的所有节点不必完全相同，一个关键特征将Client-Server网络与P2P网络区分开来：缺乏具有唯一权限的专用服务器。在开放、无许可的P2P的网络中，任何节点都可以决定提供与P2P节点相关的全部或部分服务集。

## P2P的特点
>
> 与Client-Server网络相比，P2P网络能够在其上构建不同类别的应用程序，这些应用程序是无许可、容错、和抗审查的。

1. 无许可：因为数据和状态时跨多个节点复制的，所以没有服务器可以切断客户机对信息的访问。
2. 容错性；因为没有单点故障，例如中央服务器。
3. 抗审查：如区块链等网络。
4. P2P计算还可以更好地利用资源。

## P2P的复杂性
>
> 构建P2P系统要比传统Client-Server的系统复杂

1. 传输：P2P网络中的每个peer都可以使用不同的协议，例如：HTTP(s)、TCP、UDP等。
2. 身份：每个peer都需要直到其想要连接并发送消息的peer()的身份。
3. 安全性：每个peer可以通过各种路由（例如数据包在IP协议中的分布方式）从其他peer接收消息，这意味这恶如果消息不是针对自身的，则每个peer都应该能够将消息路由到其他peer。
4. 消息传递：P2P网络应该能够发送点对点消息或组消息（以发布/订阅模式）

## P2P的要求 - 传输

1. TCP/IP和UDP协议无处不在，在编写网络应用程序时非常流行。但还有其它更高级别的协议，如HTTP(TCP上分层)和QUIC(UDP上分层)。
2. P2P网络中的每个peer都应该能够启动到另一个节点的连接，并且由于网络中peer的多样性，能够通过多个协议监听传入的连接。

## 公钥和私钥

- 加密身份使用公钥基础设施（PKI），广泛用于为用户、设备和应用程序提供唯一身份，并保护端到端通信的安全。
- 它的工作原理是创建俩个不同的加密密钥，也称为由私钥和公钥组成的密钥对，它们之间具有数学关系。
- 密钥对有着广泛的应用，但在P2P网络中。

 1. 节点使用密钥对彼此进行身份识别和身份验证。
 2. 公钥可以在网络中与其他人共享，但绝不能泄漏节点的私钥。

## 公钥和私钥的例子 - 访问传统的服务器

- 如果你想连接到数据中心的远程服务器（使用ssh），用户可以生成密钥对并在远程服务器上配置公钥，从而授予用户访问权限。
- 但远程服务器如何直到哪个用户是该公钥的所有者？
    1. 为了实现这一点，当连接（通过SSH）到远程服务器时，用户必须指定私钥（与存储在服务器上的公钥相关联的）。
    2. 私钥从不发送到远程服务器，但是SSH客户端（在本地服务器上运行）使用用户的私钥向远程SSH服务器进行身份验证。

## 多地址

- 在libp2p中，peer的身份在其整个生命周期内都是稳定且可验证的。
- 但libp2p区分了peer的身份和位置。
  1. peer的身份是peerid
- peer的位置是可以到达对等方的网络地址。
  1. 例如，可以通过TCP、websockets、QUIC或任何其它协议访问peer。libp2p将这些网络地址编码成一个自描述格式，它叫做multiaddress(multiaddr).因此，在libp2p中，multiaddress表示peer的位置。
- 当P2P网络上的节点共享其联系信息时，它们会发送一个包含网络地址和peerid的多地址（multiaddress）。
- 节点多地址的peerid表示如下：
    1. /p2p/12D3KooWC7Z7KQciMdPwUxthGmbLLMiAMW8wM1TeEannth6dvHVX
- 多地址的网络地址表示如下：
    1. /ip4/192.168.1.4/tcp/3000
- 节点的完整多地址就是peerid和网络地址的组合：
    1. /ip4/192.168.1.4/tcp/3000/p2p/12D3KooWC7Z7KQciMdPwUxthGmbLLMiAMW8wM1TeEannth6dvHVX

### Swarm和网络行为

- Swarm是libp2p中给定P2P节点内的网络管理器模块。
- 他维护从给定节点到远程节点的所有活动和挂起连接，并管理已打开的所有子流的状态。

### Swarm的结构和上下文环境

- Swarm代表了一个低级接口，并提供了对libp2p网络的细粒度控制。Swarm是使用传输、网络行为和节点peerid的组合构建的。
- 传输(Transport)会知名如何在网络上发送字节，而网络行为会知名发送什么字节，发送给谁。

1. 多个网络行为可以与单个运行节点相关联。

- 需要注意的是，同一套代码在libp2p网络的所有节点上运行，这与客户端和服务器具有不同代码库的Client-server模型不同。
